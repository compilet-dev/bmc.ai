var zt=Object.defineProperty;var Jt=(e,t,n)=>t in e?zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var M=(e,t,n)=>Jt(e,typeof t!="symbol"?t+"":t,n);import{r as l,j as c,a as Xt}from"./index-CKB-v0eF.js";import{c as te,u as z,b as Qt,a as j,B as F,C as Te}from"./card-CdOATahm.js";import{K as Zt,I as ft,E as en,a as tn,B as Oe,L as je}from"./badge-DHuywlE1.js";import{b as Q,c as G,e as nn,a as on,u as me,P as Ne,X as rn,T as sn,C as an,d as cn}from"./index-Bmha2bSx.js";import{P as D,d as ln,c as un,b as dn,E as fn}from"./index-4CZqBsOn.js";import{B as oe}from"./bot-D-7VQm8y.js";import{F as hn}from"./file-text-1y_M2mYw.js";/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],mn=te("globe",pn);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],vn=te("send",gn);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],En=te("settings",yn);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Cn=te("user",xn);/**
 * @license lucide-react v0.536.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],De=te("wrench",bn);var ke;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(ke||(ke={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(Me||(Me={}));var Pe;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Pe||(Pe={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Le=["user","model","function","system"];var Fe;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Fe||(Fe={}));var Ge;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(Ge||(Ge={}));var Ue;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Ue||(Ue={}));var $e;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})($e||($e={}));var X;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(X||(X={}));var We;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(We||(We={}));var Ke;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Ke||(Ke={}));var Be;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Be||(Be={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class B extends R{constructor(t,n){super(t),this.response=n}}class ht extends R{constructor(t,n,o,r){super(t),this.status=n,this.statusText=o,this.errorDetails=r}}class U extends R{}class pt extends R{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn="https://generativelanguage.googleapis.com",Sn="v1beta",Nn="0.24.1",Rn="genai-js";var W;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(W||(W={}));class An{constructor(t,n,o,r,s){this.model=t,this.task=n,this.apiKey=o,this.stream=r,this.requestOptions=s}toString(){var t,n;const o=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||Sn;let s=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||wn}/${o}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function In(e){const t=[];return e!=null&&e.apiClient&&t.push(e.apiClient),t.push(`${Rn}/${Nn}`),t.join(" ")}async function _n(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",In(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let o=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(o){if(!(o instanceof Headers))try{o=new Headers(o)}catch(r){throw new U(`unable to convert customHeaders value ${JSON.stringify(o)} to Headers: ${r.message}`)}for(const[r,s]of o.entries()){if(r==="x-goog-api-key")throw new U(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new U(`Header name ${r} can only be set using the apiClient field`);n.append(r,s)}}return n}async function Tn(e,t,n,o,r,s){const i=new An(e,t,n,o,s);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},kn(s)),{method:"POST",headers:await _n(i),body:r})}}async function ne(e,t,n,o,r,s={},i=fetch){const{url:a,fetchOptions:f}=await Tn(e,t,n,o,r,s);return On(a,f,i)}async function On(e,t,n=fetch){let o;try{o=await n(e,t)}catch(r){jn(r,e)}return o.ok||await Dn(o,e),o}function jn(e,t){let n=e;throw n.name==="AbortError"?(n=new pt(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof ht||e instanceof U||(n=new R(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function Dn(e,t){let n="",o;try{const r=await e.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,o=r.error.details)}catch{}throw new ht(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,o)}function kn(e){const t={};if((e==null?void 0:e.signal)!==void 0||(e==null?void 0:e.timeout)>=0){const n=new AbortController;(e==null?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),e!=null&&e.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ce(e.candidates[0]))throw new B(`${L(e)}`,e);return Mn(e)}else if(e.promptFeedback)throw new B(`Text not available. ${L(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ce(e.candidates[0]))throw new B(`${L(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),He(e)[0]}else if(e.promptFeedback)throw new B(`Function call not available. ${L(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ce(e.candidates[0]))throw new B(`${L(e)}`,e);return He(e)}else if(e.promptFeedback)throw new B(`Function call not available. ${L(e)}`,e)},e}function Mn(e){var t,n,o,r;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)i.text&&s.push(i.text),i.executableCode&&s.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&s.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function He(e){var t,n,o,r;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const i of(r=(o=e.candidates)===null||o===void 0?void 0:o[0].content)===null||r===void 0?void 0:r.parts)i.functionCall&&s.push(i.functionCall);if(s.length>0)return s}const Pn=[X.RECITATION,X.SAFETY,X.LANGUAGE];function ce(e){return!!e.finishReason&&Pn.includes(e.finishReason)}function L(e){var t,n,o;let r="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)r+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(r+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((o=e.candidates)===null||o===void 0)&&o[0]){const s=e.candidates[0];ce(s)&&(r+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(r+=`: ${s.finishMessage}`))}return r}function Z(e){return this instanceof Z?(this.v=e,this):new Z(e)}function Ln(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(e,t||[]),r,s=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(p){o[p]&&(r[p]=function(d){return new Promise(function(y,u){s.push([p,d,y,u])>1||a(p,d)})})}function a(p,d){try{f(o[p](d))}catch(y){g(s[0][3],y)}}function f(p){p.value instanceof Z?Promise.resolve(p.value.v).then(m,h):g(s[0][2],p)}function m(p){a("next",p)}function h(p){a("throw",p)}function g(p,d){p(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qe=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Fn(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=$n(t),[o,r]=n.tee();return{stream:Un(o),response:Gn(r)}}async function Gn(e){const t=[],n=e.getReader();for(;;){const{done:o,value:r}=await n.read();if(o)return Re(Wn(t));t.push(r)}}function Un(e){return Ln(this,arguments,function*(){const n=e.getReader();for(;;){const{value:o,done:r}=yield Z(n.read());if(r)break;yield yield Z(Re(o))}})}function $n(e){const t=e.getReader();return new ReadableStream({start(o){let r="";return s();function s(){return t.read().then(({value:i,done:a})=>{if(a){if(r.trim()){o.error(new R("Failed to parse stream"));return}o.close();return}r+=i;let f=r.match(qe),m;for(;f;){try{m=JSON.parse(f[1])}catch{o.error(new R(`Error parsing JSON response: "${f[1]}"`));return}o.enqueue(m),r=r.substring(f[0].length),f=r.match(qe)}return s()}).catch(i=>{let a=i;throw a.stack=i.stack,a.name==="AbortError"?a=new pt("Request aborted when reading from the stream"):a=new R("Error reading from the stream"),a})}}})}function Wn(e){const t=e[e.length-1],n={promptFeedback:t==null?void 0:t.promptFeedback};for(const o of e){if(o.candidates){let r=0;for(const s of o.candidates)if(n.candidates||(n.candidates=[]),n.candidates[r]||(n.candidates[r]={index:r}),n.candidates[r].citationMetadata=s.citationMetadata,n.candidates[r].groundingMetadata=s.groundingMetadata,n.candidates[r].finishReason=s.finishReason,n.candidates[r].finishMessage=s.finishMessage,n.candidates[r].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[r].content||(n.candidates[r].content={role:s.content.role||"user",parts:[]});const i={};for(const a of s.content.parts)a.text&&(i.text=a.text),a.functionCall&&(i.functionCall=a.functionCall),a.executableCode&&(i.executableCode=a.executableCode),a.codeExecutionResult&&(i.codeExecutionResult=a.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),n.candidates[r].content.parts.push(i)}r++}o.usageMetadata&&(n.usageMetadata=o.usageMetadata)}return n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mt(e,t,n,o){const r=await ne(t,W.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),o);return Fn(r)}async function gt(e,t,n,o){const s=await(await ne(t,W.GENERATE_CONTENT,e,!1,JSON.stringify(n),o)).json();return{response:Re(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vt(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function ee(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return Kn(t)}function Kn(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let o=!1,r=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),r=!0):(t.parts.push(s),o=!0);if(o&&r)throw new R("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!o&&!r)throw new R("No content is provided for sending chat message.");return o?t:n}function Bn(e,t){var n;let o={model:t==null?void 0:t.model,generationConfig:t==null?void 0:t.generationConfig,safetySettings:t==null?void 0:t.safetySettings,tools:t==null?void 0:t.tools,toolConfig:t==null?void 0:t.toolConfig,systemInstruction:t==null?void 0:t.systemInstruction,cachedContent:(n=t==null?void 0:t.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=e.generateContentRequest!=null;if(e.contents){if(r)throw new U("CountTokensRequest must have one of contents or generateContentRequest, not both.");o.contents=e.contents}else if(r)o=Object.assign(Object.assign({},o),e.generateContentRequest);else{const s=ee(e);o.contents=[s]}return{generateContentRequest:o}}function Ye(e){let t;return e.contents?t=e:t={contents:[ee(e)]},e.systemInstruction&&(t.systemInstruction=vt(e.systemInstruction)),t}function Hn(e){return typeof e=="string"||Array.isArray(e)?{content:ee(e)}:e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ve=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],qn={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Yn(e){let t=!1;for(const n of e){const{role:o,parts:r}=n;if(!t&&o!=="user")throw new R(`First content should be with role 'user', got ${o}`);if(!Le.includes(o))throw new R(`Each item should include role field. Got ${o} but valid roles are: ${JSON.stringify(Le)}`);if(!Array.isArray(r))throw new R("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new R("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of r)for(const f of Ve)f in a&&(s[f]+=1);const i=qn[o];for(const a of Ve)if(!i.includes(a)&&s[a]>0)throw new R(`Content with role '${o}' can't contain '${a}' part`);t=!0}}function ze(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const o of n.parts)if(o===void 0||Object.keys(o).length===0||o.text!==void 0&&o.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je="SILENT_ERROR";class Vn{constructor(t,n,o,r={}){this.model=n,this.params=o,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,o!=null&&o.history&&(Yn(o.history),this._history=o.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var o,r,s,i,a,f;await this._sendPromise;const m=ee(t),h={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,m]},g=Object.assign(Object.assign({},this._requestOptions),n);let p;return this._sendPromise=this._sendPromise.then(()=>gt(this._apiKey,this.model,h,g)).then(d=>{var y;if(ze(d.response)){this._history.push(m);const u=Object.assign({parts:[],role:"model"},(y=d.response.candidates)===null||y===void 0?void 0:y[0].content);this._history.push(u)}else{const u=L(d.response);u&&console.warn(`sendMessage() was unsuccessful. ${u}. Inspect response object for details.`)}p=d}).catch(d=>{throw this._sendPromise=Promise.resolve(),d}),await this._sendPromise,p}async sendMessageStream(t,n={}){var o,r,s,i,a,f;await this._sendPromise;const m=ee(t),h={safetySettings:(o=this.params)===null||o===void 0?void 0:o.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(f=this.params)===null||f===void 0?void 0:f.cachedContent,contents:[...this._history,m]},g=Object.assign(Object.assign({},this._requestOptions),n),p=mt(this._apiKey,this.model,h,g);return this._sendPromise=this._sendPromise.then(()=>p).catch(d=>{throw new Error(Je)}).then(d=>d.response).then(d=>{if(ze(d)){this._history.push(m);const y=Object.assign({},d.candidates[0].content);y.role||(y.role="model"),this._history.push(y)}else{const y=L(d);y&&console.warn(`sendMessageStream() was unsuccessful. ${y}. Inspect response object for details.`)}}).catch(d=>{d.message!==Je&&console.error(d)}),p}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zn(e,t,n,o){return(await ne(t,W.COUNT_TOKENS,e,!1,JSON.stringify(n),o)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jn(e,t,n,o){return(await ne(t,W.EMBED_CONTENT,e,!1,JSON.stringify(n),o)).json()}async function Xn(e,t,n,o){const r=n.requests.map(i=>Object.assign(Object.assign({},i),{model:t}));return(await ne(t,W.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:r}),o)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(t,n,o={}){this.apiKey=t,this._requestOptions=o,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=vt(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var o;const r=Ye(t),s=Object.assign(Object.assign({},this._requestOptions),n);return gt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),s)}async generateContentStream(t,n={}){var o;const r=Ye(t),s=Object.assign(Object.assign({},this._requestOptions),n);return mt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(o=this.cachedContent)===null||o===void 0?void 0:o.name},r),s)}startChat(t){var n;return new Vn(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const o=Bn(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return zn(this.apiKey,this.model,o,r)}async embedContent(t,n={}){const o=Hn(t),r=Object.assign(Object.assign({},this._requestOptions),n);return Jn(this.apiKey,this.model,o,r)}async batchEmbedContents(t,n={}){const o=Object.assign(Object.assign({},this._requestOptions),n);return Xn(this.apiKey,this.model,t,o)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new R("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Xe(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,o){if(!t.name)throw new U("Cached content must contain a `name` field.");if(!t.model)throw new U("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if(n!=null&&n[i]&&t[i]&&(n==null?void 0:n[i])!==t[i]){if(i==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,f=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(a===f)continue}throw new U(`Different value for "${i}" specified in modelParams (${n[i]}) and cachedContent (${t[i]})`)}const s=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new Xe(this.apiKey,s,o)}}const Qe={name:"web_search",description:"Search the web for information using Google Custom Search or SerpAPI",parameters:{type:"object",properties:{query:{type:"string",description:"The search query to look up on the web"},num_results:{type:"number",description:"Number of search results to return (default: 5, max: 10)",minimum:1,maximum:10}},required:["query"]}},Ze={name:"web_crawl",description:"Fetch and extract content from a specific website URL, including client-side rendered content",parameters:{type:"object",properties:{url:{type:"string",description:"The URL of the website to crawl and extract content from"},selector:{type:"string",description:'Optional CSS selector to extract specific content (e.g., "article", ".main-content")'},waitForSelector:{type:"string",description:"CSS selector to wait for before extracting content (for client-side rendered pages)"},useJavaScript:{type:"boolean",description:"Whether to wait for JavaScript to execute (for SPAs and dynamic content)"}},required:["url"]}};class Zn{constructor(t){M(this,"serpApiKey",null);M(this,"corsProxy","https://corsproxy.io/?");this.serpApiKey=t||null}setSerpApiKey(t){this.serpApiKey=t}async webSearch(t,n=5){try{if(this.serpApiKey)return await this.searchWithSerpApi(t,n);const o=await this.searchWithBrave(t,n);if(o&&o.length>0)return o;const r=await this.searchWithSearx(t,n);return r&&r.length>0?r:await this.searchWithDuckDuckGo(t,n)}catch(o){return console.error("Web search error:",o),this.getMockSearchResults(t,n)}}async searchWithSerpApi(t,n){const o=`https://serpapi.com/search.json?q=${encodeURIComponent(t)}&api_key=${this.serpApiKey}&num=${n}`;try{const s=await(await fetch(o)).json();if(s.error)throw new Error(s.error);return(s.organic_results||[]).slice(0,n).map(i=>({title:i.title,url:i.link,snippet:i.snippet||i.description||""}))}catch(r){throw console.error("SerpAPI search failed:",r),r}}async searchWithBrave(t,n){return console.log("[WebTools] Trying Brave Search for:",t),[]}async searchWithSearx(t,n){console.log("[WebTools] Trying Searx instance for:",t);const o=["https://searx.be","https://searx.org","https://search.sapti.me"];for(const r of o)try{const s=`${r}/search?q=${encodeURIComponent(t)}&format=json&limit=${n}`,i=await fetch(s,{headers:{Accept:"application/json"}});if(i.ok){const a=await i.json();if(console.log("[WebTools] Searx response:",a),a.results&&a.results.length>0)return a.results.slice(0,n).map(f=>({title:f.title||"No title",url:f.url||f.link||"",snippet:f.content||f.description||"No description available"}))}}catch(s){console.log(`[WebTools] Searx instance ${r} failed:`,s);continue}return[]}getMockSearchResults(t,n){console.log("[WebTools] Providing mock results for:",t);const o={apple:[{title:"Best Apple Varieties - Honeycrisp",url:"https://en.wikipedia.org/wiki/Honeycrisp",snippet:"Honeycrisp apples are exceptionally crisp and juicy with a sweet-tart flavor. They are excellent for eating fresh and are one of the most popular apple varieties."},{title:"Top Apple Varieties - Fuji",url:"https://en.wikipedia.org/wiki/Fuji_(apple)",snippet:"Fuji apples are sweet, crisp, and store well. Originally from Japan, they have become one of the most popular apple varieties worldwide."},{title:"Apple Variety Guide - Granny Smith",url:"https://en.wikipedia.org/wiki/Granny_Smith",snippet:"Granny Smith apples are tart, crisp green apples that are excellent for baking and cooking. They hold their shape well when cooked."}],default:[{title:`Search results for "${t}"`,url:`https://www.google.com/search?q=${encodeURIComponent(t)}`,snippet:"Web search is currently limited. For better results, consider adding a search API key or try searching directly on Google."}]};for(const r in o)if(t.toLowerCase().includes(r)&&r!=="default")return o[r].slice(0,n);return o.default}async searchWithDuckDuckGo(t,n){const o=`${this.corsProxy}${encodeURIComponent(`https://api.duckduckgo.com/?q=${encodeURIComponent(t)}&format=json&no_html=1&skip_disambig=1`)}`;console.log("[WebTools] DuckDuckGo search for:",t),console.log("[WebTools] Request URL:",o);try{const s=await(await fetch(o)).json();console.log("[WebTools] DuckDuckGo response:",JSON.stringify(s,null,2).substring(0,500));const i=[];if(s.AbstractURL&&s.AbstractText&&i.push({title:s.Heading||t,url:s.AbstractURL,snippet:s.AbstractText}),s.RelatedTopics)for(const a of s.RelatedTopics.slice(0,n-1))a.FirstURL&&a.Text&&i.push({title:a.Text.split(" - ")[0]||a.Text,url:a.FirstURL,snippet:a.Text});return i.length===0&&(console.log("[WebTools] No results from DuckDuckGo, providing fallback"),i.push({title:"No direct results found",url:`https://duckduckgo.com/?q=${encodeURIComponent(t)}`,snippet:`Search for "${t}" on DuckDuckGo for more results. For better search capabilities, consider adding a SerpAPI key.`})),console.log("[WebTools] Final search results:",i),i.slice(0,n)}catch(r){return console.error("DuckDuckGo search failed:",r),[{title:"Search failed - Manual search required",url:`https://www.google.com/search?q=${encodeURIComponent(t)}`,snippet:"Automated search failed. Click the link to search manually on Google."}]}}async webCrawl(t,n,o,r){var s,i;try{const a=new URL(t);if(!["http:","https:"].includes(a.protocol))throw new Error("Invalid URL protocol. Only HTTP and HTTPS are supported.");if(r||o){const v=await this.fetchWithJavaScript(t,n,o);if(v)return v}const f=[`https://corsproxy.io/?${encodeURIComponent(t)}`,`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`,`https://cors-anywhere.herokuapp.com/${t}`];let m=null,h=null;for(const v of f)try{if(console.log("[WebTools] Trying proxy:",v.substring(0,50)+"..."),m=await fetch(v,{method:"GET",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"}}),m.ok){h=v;break}}catch(x){console.log("[WebTools] Proxy failed:",x);continue}if(!m||!m.ok)throw new Error("Failed to fetch URL: All proxy services failed");const g=await m.text(),d=new DOMParser().parseFromString(g,"text/html"),y=((s=d.querySelector("title"))==null?void 0:s.textContent)||"Untitled";let u="";if(n){const v=d.querySelectorAll(n);u=Array.from(v).map(x=>x.textContent).join(`

`).trim()}else{const v=["main","article",'[role="main"]',".main-content","#main-content",".content","#content",".post-content",".entry-content",".article-content"];for(const x of v){const b=d.querySelector(x);if(b!=null&&b.textContent){u=b.textContent.trim();break}}if(!u){d.querySelectorAll("script, style, noscript").forEach(S=>S.remove());const b=d.querySelector("body");b&&(u=((i=b.textContent)==null?void 0:i.trim())||"")}}u=u.replace(/\s+/g," ").replace(/\n{3,}/g,`

`).trim();const E=1e4;return u.length>E&&(u=u.substring(0,E)+`...
[Content truncated due to length]`),{url:t,title:y,content:u||"No content could be extracted from this page."}}catch(a){return console.error("Web crawl error:",a),{url:t,title:"Error",content:"",error:a instanceof Error?a.message:"Failed to crawl website"}}}async fetchWithJavaScript(t,n,o){var r,s;try{const i="https://api.scraperapi.com/structured/web/extract",a=`https://render-tron.appspot.com/render/${encodeURIComponent(t)}`;try{const f=await fetch(a);if(f.ok){const m=await f.text(),g=new DOMParser().parseFromString(m,"text/html"),p=((r=g.querySelector("title"))==null?void 0:r.textContent)||"Untitled";let d="";if(n){const u=g.querySelectorAll(n);d=Array.from(u).map(E=>E.textContent).join(`

`).trim()}else{g.querySelectorAll("script, style, noscript").forEach(v=>v.remove());const E=["main","article",'[role="main"]',".main-content","#main-content",".content","#content"];for(const v of E){const x=g.querySelector(v);if(x!=null&&x.textContent){d=x.textContent.trim();break}}if(!d){const v=g.querySelector("body");d=((s=v==null?void 0:v.textContent)==null?void 0:s.trim())||""}}d=d.replace(/\s+/g," ").replace(/\n{3,}/g,`

`).trim();const y=1e4;return d.length>y&&(d=d.substring(0,y)+`...
[Content truncated]`),{url:t,title:p,content:d}}}catch{console.log("Render service failed, falling back to regular fetch")}return null}catch(i){return console.error("JavaScript rendering failed:",i),null}}async searchWithIframe(t,n){return new Promise(o=>{console.log("[WebTools] Attempting iframe-based search for:",t);const r=document.createElement("div");r.style.cssText="position: fixed; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden;",document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r),console.log("[WebTools] Iframe search not available for cross-origin"),o(null)},100)})}async extractWithIframe(t,n,o=3e3){return new Promise(r=>{const s=document.createElement("iframe");s.style.display="none",s.src=t;const i=setTimeout(()=>{document.body.removeChild(s),r(null)},o+5e3);s.onload=()=>{setTimeout(()=>{var a,f,m;try{const h=s.contentDocument||((a=s.contentWindow)==null?void 0:a.document);if(!h){r(null);return}const g=((f=h.querySelector("title"))==null?void 0:f.textContent)||"Untitled";let p="";if(n){const d=h.querySelectorAll(n);p=Array.from(d).map(y=>y.textContent).join(`

`).trim()}else{const d=h.querySelector("body");p=((m=d==null?void 0:d.textContent)==null?void 0:m.trim())||""}clearTimeout(i),document.body.removeChild(s),r({url:t,title:g,content:this.summarizeContent(p)})}catch{clearTimeout(i),document.body.removeChild(s),r(null)}},o)},document.body.appendChild(s)})}summarizeContent(t,n=2e3){if(t.length<=n)return t;const o=t.substring(0,n),r=o.lastIndexOf("."),s=o.lastIndexOf("?"),i=o.lastIndexOf("!"),a=Math.max(r,s,i);return a>n*.8?o.substring(0,a+1)+`

[Content summarized for brevity]`:o+`...

[Content summarized for brevity]`}}class eo{constructor(t,n){M(this,"genAI",null);M(this,"model",null);M(this,"chatSession",null);M(this,"webTools");M(this,"enableTools",!0);this.webTools=new Zn(n),t&&this.initialize(t)}initialize(t){this.genAI=new Qn(t),this.model=this.genAI.getGenerativeModel({model:"gemini-2.0-flash-exp",tools:this.enableTools?[{functionDeclarations:[Qe,Ze]}]:void 0}),this.chatSession=this.model.startChat({history:[],generationConfig:{maxOutputTokens:8192,temperature:.7,topP:.95,topK:40}})}setToolsEnabled(t){this.enableTools=t,this.genAI&&(this.model=this.genAI.getGenerativeModel({model:"gemini-2.0-flash-exp",tools:t?[{functionDeclarations:[Qe,Ze]}]:void 0}),this.chatSession=this.model.startChat({history:[],generationConfig:{maxOutputTokens:8192,temperature:.7,topP:.95,topK:40}}))}setSerpApiKey(t){this.webTools.setSerpApiKey(t)}async sendMessage(t){var n;if(!this.chatSession)throw new Error("Chat service not initialized. Please set your API key.");try{console.log("[Gemini] Sending message:",t);const r=(await this.chatSession.sendMessage(t)).response,s=r.functionCalls();if(console.log("[Gemini] Function calls requested:",(s==null?void 0:s.length)||0),s&&s.length>0){const i=[],a=[];for(const h of s){console.log("[Gemini] Executing function:",h.name,"with args:",h.args),i.push({name:h.name,args:h.args});let g;try{switch(h.name){case"web_search":const p=await this.webTools.webSearch(h.args.query,h.args.num_results||5);console.log("[Gemini] Search returned",p.length,"results"),console.log("[Gemini] Raw search results:",JSON.stringify(p,null,2)),g={results:p.map((y,u)=>`${u+1}. ${y.title}
   URL: ${y.url}
   ${y.snippet}`).join(`

`),count:p.length},console.log("[Gemini] Formatted function result:",g);break;case"web_crawl":const d=await this.webTools.webCrawl(h.args.url,h.args.selector,h.args.waitForSelector,h.args.useJavaScript);console.log("[Gemini] Web crawl result:",{url:d.url,title:d.title,contentLength:(n=d.content)==null?void 0:n.length,hasError:!!d.error}),g={url:d.url,title:d.title,content:d.content||d.error||"No content extracted",success:!d.error};break;default:g={error:`Unknown function: ${h.name}`}}}catch(p){g={error:`Function execution failed: ${p instanceof Error?p.message:"Unknown error"}`}}a.push({name:h.name,result:g})}console.log("[Gemini] Sending function results back to model"),console.log("[Gemini] Tool results to send:",JSON.stringify(a,null,2));let f;if(a.length===1){const h=[{functionResponse:{name:a[0].name,response:a[0].result}}];console.log("[Gemini] Sending single function response:",JSON.stringify(h,null,2)),f=await this.chatSession.sendMessage(h)}else{const h=a.map(g=>({functionResponse:{name:g.name,response:g.result}}));console.log("[Gemini] Sending multiple function responses:",JSON.stringify(h,null,2)),f=await this.chatSession.sendMessage(h)}const m=f.response.text();return console.log("[Gemini] Final response from model:",m),{text:m,toolCalls:i,toolResults:a}}return{text:r.text()}}catch(o){throw console.error("Error sending message to Gemini:",o),o}}async testConnection(){if(!this.model)return!1;try{return!!(await this.model.generateContent('Hello, please respond with "OK" if you can receive this message.')).response}catch(t){return console.error("Connection test failed:",t),!1}}getModelName(){return"gemini-2.0-flash-exp"}isInitialized(){return!!this.chatSession}reset(){this.model&&(this.chatSession=this.model.startChat({history:[],generationConfig:{maxOutputTokens:2048,temperature:.9,topP:1,topK:1}}))}}function to(e,t=globalThis==null?void 0:globalThis.document){const n=Q(e);l.useEffect(()=>{const o=r=>{r.key==="Escape"&&n(r)};return t.addEventListener("keydown",o,{capture:!0}),()=>t.removeEventListener("keydown",o,{capture:!0})},[n,t])}var no="DismissableLayer",we="dismissableLayer.update",oo="dismissableLayer.pointerDownOutside",ro="dismissableLayer.focusOutside",et,yt=l.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Et=l.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:o,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...f}=e,m=l.useContext(yt),[h,g]=l.useState(null),p=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,d]=l.useState({}),y=z(t,w=>g(w)),u=Array.from(m.layers),[E]=[...m.layersWithOutsidePointerEventsDisabled].slice(-1),v=u.indexOf(E),x=h?u.indexOf(h):-1,b=m.layersWithOutsidePointerEventsDisabled.size>0,S=x>=v,N=io(w=>{const _=w.target,$=[...m.branches].some(C=>C.contains(_));!S||$||(r==null||r(w),i==null||i(w),w.defaultPrevented||a==null||a())},p),I=co(w=>{const _=w.target;[...m.branches].some(C=>C.contains(_))||(s==null||s(w),i==null||i(w),w.defaultPrevented||a==null||a())},p);return to(w=>{x===m.layers.size-1&&(o==null||o(w),!w.defaultPrevented&&a&&(w.preventDefault(),a()))},p),l.useEffect(()=>{if(h)return n&&(m.layersWithOutsidePointerEventsDisabled.size===0&&(et=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),m.layersWithOutsidePointerEventsDisabled.add(h)),m.layers.add(h),tt(),()=>{n&&m.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=et)}},[h,p,n,m]),l.useEffect(()=>()=>{h&&(m.layers.delete(h),m.layersWithOutsidePointerEventsDisabled.delete(h),tt())},[h,m]),l.useEffect(()=>{const w=()=>d({});return document.addEventListener(we,w),()=>document.removeEventListener(we,w)},[]),c.jsx(D.div,{...f,ref:y,style:{pointerEvents:b?S?"auto":"none":void 0,...e.style},onFocusCapture:G(e.onFocusCapture,I.onFocusCapture),onBlurCapture:G(e.onBlurCapture,I.onBlurCapture),onPointerDownCapture:G(e.onPointerDownCapture,N.onPointerDownCapture)})});Et.displayName=no;var so="DismissableLayerBranch",ao=l.forwardRef((e,t)=>{const n=l.useContext(yt),o=l.useRef(null),r=z(t,o);return l.useEffect(()=>{const s=o.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),c.jsx(D.div,{...e,ref:r})});ao.displayName=so;function io(e,t=globalThis==null?void 0:globalThis.document){const n=Q(e),o=l.useRef(!1),r=l.useRef(()=>{});return l.useEffect(()=>{const s=a=>{if(a.target&&!o.current){let f=function(){xt(oo,n,m,{discrete:!0})};const m={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",r.current),r.current=f,t.addEventListener("click",r.current,{once:!0})):f()}else t.removeEventListener("click",r.current);o.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",r.current)}},[t,n]),{onPointerDownCapture:()=>o.current=!0}}function co(e,t=globalThis==null?void 0:globalThis.document){const n=Q(e),o=l.useRef(!1);return l.useEffect(()=>{const r=s=>{s.target&&!o.current&&xt(ro,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",r),()=>t.removeEventListener("focusin",r)},[t,n]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function tt(){const e=new CustomEvent(we);document.dispatchEvent(e)}function xt(e,t,n,{discrete:o}){const r=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&r.addEventListener(e,t,{once:!0}),o?ln(r,s):r.dispatchEvent(s)}var ge="focusScope.autoFocusOnMount",ve="focusScope.autoFocusOnUnmount",nt={bubbles:!1,cancelable:!0},lo="FocusScope",Ct=l.forwardRef((e,t)=>{const{loop:n=!1,trapped:o=!1,onMountAutoFocus:r,onUnmountAutoFocus:s,...i}=e,[a,f]=l.useState(null),m=Q(r),h=Q(s),g=l.useRef(null),p=z(t,u=>f(u)),d=l.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;l.useEffect(()=>{if(o){let u=function(b){if(d.paused||!a)return;const S=b.target;a.contains(S)?g.current=S:P(g.current,{select:!0})},E=function(b){if(d.paused||!a)return;const S=b.relatedTarget;S!==null&&(a.contains(S)||P(g.current,{select:!0}))},v=function(b){if(document.activeElement===document.body)for(const N of b)N.removedNodes.length>0&&P(a)};document.addEventListener("focusin",u),document.addEventListener("focusout",E);const x=new MutationObserver(v);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",u),document.removeEventListener("focusout",E),x.disconnect()}}},[o,a,d.paused]),l.useEffect(()=>{if(a){rt.add(d);const u=document.activeElement;if(!a.contains(u)){const v=new CustomEvent(ge,nt);a.addEventListener(ge,m),a.dispatchEvent(v),v.defaultPrevented||(uo(go(bt(a)),{select:!0}),document.activeElement===u&&P(a))}return()=>{a.removeEventListener(ge,m),setTimeout(()=>{const v=new CustomEvent(ve,nt);a.addEventListener(ve,h),a.dispatchEvent(v),v.defaultPrevented||P(u??document.body,{select:!0}),a.removeEventListener(ve,h),rt.remove(d)},0)}}},[a,m,h,d]);const y=l.useCallback(u=>{if(!n&&!o||d.paused)return;const E=u.key==="Tab"&&!u.altKey&&!u.ctrlKey&&!u.metaKey,v=document.activeElement;if(E&&v){const x=u.currentTarget,[b,S]=fo(x);b&&S?!u.shiftKey&&v===S?(u.preventDefault(),n&&P(b,{select:!0})):u.shiftKey&&v===b&&(u.preventDefault(),n&&P(S,{select:!0})):v===x&&u.preventDefault()}},[n,o,d.paused]);return c.jsx(D.div,{tabIndex:-1,...i,ref:p,onKeyDown:y})});Ct.displayName=lo;function uo(e,{select:t=!1}={}){const n=document.activeElement;for(const o of e)if(P(o,{select:t}),document.activeElement!==n)return}function fo(e){const t=bt(e),n=ot(t,e),o=ot(t.reverse(),e);return[n,o]}function bt(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const r=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||r?NodeFilter.FILTER_SKIP:o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function ot(e,t){for(const n of e)if(!ho(n,{upTo:t}))return n}function ho(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function po(e){return e instanceof HTMLInputElement&&"select"in e}function P(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&po(e)&&t&&e.select()}}var rt=mo();function mo(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=st(e,t),e.unshift(t)},remove(t){var n;e=st(e,t),(n=e[0])==null||n.resume()}}}function st(e,t){const n=[...e],o=n.indexOf(t);return o!==-1&&n.splice(o,1),n}function go(e){return e.filter(t=>t.tagName!=="A")}var vo="Portal",wt=l.forwardRef((e,t)=>{var a;const{container:n,...o}=e,[r,s]=l.useState(!1);nn(()=>s(!0),[]);const i=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?Xt.createPortal(c.jsx(D.div,{...o,ref:t}),i):null});wt.displayName=vo;var ye=0;function yo(){l.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??at()),document.body.insertAdjacentElement("beforeend",e[1]??at()),ye++,()=>{ye===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),ye--}},[])}function at(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var O=function(){return O=Object.assign||function(t){for(var n,o=1,r=arguments.length;o<r;o++){n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},O.apply(this,arguments)};function St(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}function Eo(e,t,n){if(n||arguments.length===2)for(var o=0,r=t.length,s;o<r;o++)(s||!(o in t))&&(s||(s=Array.prototype.slice.call(t,0,o)),s[o]=t[o]);return e.concat(s||Array.prototype.slice.call(t))}var le="right-scroll-bar-position",ue="width-before-scroll-bar",xo="with-scroll-bars-hidden",Co="--removed-body-scroll-bar-size";function Ee(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function bo(e,t){var n=l.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(o){var r=n.value;r!==o&&(n.value=o,n.callback(o,r))}}}})[0];return n.callback=t,n.facade}var wo=typeof window<"u"?l.useLayoutEffect:l.useEffect,it=new WeakMap;function So(e,t){var n=bo(null,function(o){return e.forEach(function(r){return Ee(r,o)})});return wo(function(){var o=it.get(n);if(o){var r=new Set(o),s=new Set(e),i=n.current;r.forEach(function(a){s.has(a)||Ee(a,null)}),s.forEach(function(a){r.has(a)||Ee(a,i)})}it.set(n,e)},[e]),n}function No(e){return e}function Ro(e,t){t===void 0&&(t=No);var n=[],o=!1,r={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(s){var i=t(s,o);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(o=!0;n.length;){var i=n;n=[],i.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){o=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(s),i=n}var f=function(){var h=i;i=[],h.forEach(s)},m=function(){return Promise.resolve().then(f)};m(),n={push:function(h){i.push(h),m()},filter:function(h){return i=i.filter(h),n}}}};return r}function Ao(e){e===void 0&&(e={});var t=Ro(null);return t.options=O({async:!0,ssr:!1},e),t}var Nt=function(e){var t=e.sideCar,n=St(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=t.read();if(!o)throw new Error("Sidecar medium not found");return l.createElement(o,O({},n))};Nt.isSideCarExport=!0;function Io(e,t){return e.useMedium(t),Nt}var Rt=Ao(),xe=function(){},fe=l.forwardRef(function(e,t){var n=l.useRef(null),o=l.useState({onScrollCapture:xe,onWheelCapture:xe,onTouchMoveCapture:xe}),r=o[0],s=o[1],i=e.forwardProps,a=e.children,f=e.className,m=e.removeScrollBar,h=e.enabled,g=e.shards,p=e.sideCar,d=e.noRelative,y=e.noIsolation,u=e.inert,E=e.allowPinchZoom,v=e.as,x=v===void 0?"div":v,b=e.gapMode,S=St(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),N=p,I=So([n,t]),w=O(O({},S),r);return l.createElement(l.Fragment,null,h&&l.createElement(N,{sideCar:Rt,removeScrollBar:m,shards:g,noRelative:d,noIsolation:y,inert:u,setCallbacks:s,allowPinchZoom:!!E,lockRef:n,gapMode:b}),i?l.cloneElement(l.Children.only(a),O(O({},w),{ref:I})):l.createElement(x,O({},w,{className:f,ref:I}),a))});fe.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};fe.classNames={fullWidth:ue,zeroRight:le};var _o=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function To(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=_o();return t&&e.setAttribute("nonce",t),e}function Oo(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function jo(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Do=function(){var e=0,t=null;return{add:function(n){e==0&&(t=To())&&(Oo(t,n),jo(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},ko=function(){var e=Do();return function(t,n){l.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},At=function(){var e=ko(),t=function(n){var o=n.styles,r=n.dynamic;return e(o,r),null};return t},Mo={left:0,top:0,right:0,gap:0},Ce=function(e){return parseInt(e||"",10)||0},Po=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],o=t[e==="padding"?"paddingTop":"marginTop"],r=t[e==="padding"?"paddingRight":"marginRight"];return[Ce(n),Ce(o),Ce(r)]},Lo=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Mo;var t=Po(e),n=document.documentElement.clientWidth,o=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,o-n+t[2]-t[0])}},Fo=At(),V="data-scroll-locked",Go=function(e,t,n,o){var r=e.left,s=e.top,i=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(xo,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(a,"px ").concat(o,`;
  }
  body[`).concat(V,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(o,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(o,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(le,` {
    right: `).concat(a,"px ").concat(o,`;
  }
  
  .`).concat(ue,` {
    margin-right: `).concat(a,"px ").concat(o,`;
  }
  
  .`).concat(le," .").concat(le,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(ue," .").concat(ue,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(V,`] {
    `).concat(Co,": ").concat(a,`px;
  }
`)},ct=function(){var e=parseInt(document.body.getAttribute(V)||"0",10);return isFinite(e)?e:0},Uo=function(){l.useEffect(function(){return document.body.setAttribute(V,(ct()+1).toString()),function(){var e=ct()-1;e<=0?document.body.removeAttribute(V):document.body.setAttribute(V,e.toString())}},[])},$o=function(e){var t=e.noRelative,n=e.noImportant,o=e.gapMode,r=o===void 0?"margin":o;Uo();var s=l.useMemo(function(){return Lo(r)},[r]);return l.createElement(Fo,{styles:Go(s,!t,r,n?"":"!important")})},Se=!1;if(typeof window<"u")try{var re=Object.defineProperty({},"passive",{get:function(){return Se=!0,!0}});window.addEventListener("test",re,re),window.removeEventListener("test",re,re)}catch{Se=!1}var H=Se?{passive:!1}:!1,Wo=function(e){return e.tagName==="TEXTAREA"},It=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Wo(e)&&n[t]==="visible")},Ko=function(e){return It(e,"overflowY")},Bo=function(e){return It(e,"overflowX")},lt=function(e,t){var n=t.ownerDocument,o=t;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var r=_t(e,o);if(r){var s=Tt(e,o),i=s[1],a=s[2];if(i>a)return!0}o=o.parentNode}while(o&&o!==n.body);return!1},Ho=function(e){var t=e.scrollTop,n=e.scrollHeight,o=e.clientHeight;return[t,n,o]},qo=function(e){var t=e.scrollLeft,n=e.scrollWidth,o=e.clientWidth;return[t,n,o]},_t=function(e,t){return e==="v"?Ko(t):Bo(t)},Tt=function(e,t){return e==="v"?Ho(t):qo(t)},Yo=function(e,t){return e==="h"&&t==="rtl"?-1:1},Vo=function(e,t,n,o,r){var s=Yo(e,window.getComputedStyle(t).direction),i=s*o,a=n.target,f=t.contains(a),m=!1,h=i>0,g=0,p=0;do{if(!a)break;var d=Tt(e,a),y=d[0],u=d[1],E=d[2],v=u-E-s*y;(y||v)&&_t(e,a)&&(g+=v,p+=y);var x=a.parentNode;a=x&&x.nodeType===Node.DOCUMENT_FRAGMENT_NODE?x.host:x}while(!f&&a!==document.body||f&&(t.contains(a)||t===a));return(h&&Math.abs(g)<1||!h&&Math.abs(p)<1)&&(m=!0),m},se=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},ut=function(e){return[e.deltaX,e.deltaY]},dt=function(e){return e&&"current"in e?e.current:e},zo=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Jo=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Xo=0,q=[];function Qo(e){var t=l.useRef([]),n=l.useRef([0,0]),o=l.useRef(),r=l.useState(Xo++)[0],s=l.useState(At)[0],i=l.useRef(e);l.useEffect(function(){i.current=e},[e]),l.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(r));var u=Eo([e.lockRef.current],(e.shards||[]).map(dt),!0).filter(Boolean);return u.forEach(function(E){return E.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),u.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(r))})}}},[e.inert,e.lockRef.current,e.shards]);var a=l.useCallback(function(u,E){if("touches"in u&&u.touches.length===2||u.type==="wheel"&&u.ctrlKey)return!i.current.allowPinchZoom;var v=se(u),x=n.current,b="deltaX"in u?u.deltaX:x[0]-v[0],S="deltaY"in u?u.deltaY:x[1]-v[1],N,I=u.target,w=Math.abs(b)>Math.abs(S)?"h":"v";if("touches"in u&&w==="h"&&I.type==="range")return!1;var _=lt(w,I);if(!_)return!0;if(_?N=w:(N=w==="v"?"h":"v",_=lt(w,I)),!_)return!1;if(!o.current&&"changedTouches"in u&&(b||S)&&(o.current=N),!N)return!0;var $=o.current||N;return Vo($,E,u,$==="h"?b:S)},[]),f=l.useCallback(function(u){var E=u;if(!(!q.length||q[q.length-1]!==s)){var v="deltaY"in E?ut(E):se(E),x=t.current.filter(function(N){return N.name===E.type&&(N.target===E.target||E.target===N.shadowParent)&&zo(N.delta,v)})[0];if(x&&x.should){E.cancelable&&E.preventDefault();return}if(!x){var b=(i.current.shards||[]).map(dt).filter(Boolean).filter(function(N){return N.contains(E.target)}),S=b.length>0?a(E,b[0]):!i.current.noIsolation;S&&E.cancelable&&E.preventDefault()}}},[]),m=l.useCallback(function(u,E,v,x){var b={name:u,delta:E,target:v,should:x,shadowParent:Zo(v)};t.current.push(b),setTimeout(function(){t.current=t.current.filter(function(S){return S!==b})},1)},[]),h=l.useCallback(function(u){n.current=se(u),o.current=void 0},[]),g=l.useCallback(function(u){m(u.type,ut(u),u.target,a(u,e.lockRef.current))},[]),p=l.useCallback(function(u){m(u.type,se(u),u.target,a(u,e.lockRef.current))},[]);l.useEffect(function(){return q.push(s),e.setCallbacks({onScrollCapture:g,onWheelCapture:g,onTouchMoveCapture:p}),document.addEventListener("wheel",f,H),document.addEventListener("touchmove",f,H),document.addEventListener("touchstart",h,H),function(){q=q.filter(function(u){return u!==s}),document.removeEventListener("wheel",f,H),document.removeEventListener("touchmove",f,H),document.removeEventListener("touchstart",h,H)}},[]);var d=e.removeScrollBar,y=e.inert;return l.createElement(l.Fragment,null,y?l.createElement(s,{styles:Jo(r)}):null,d?l.createElement($o,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function Zo(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const er=Io(Rt,Qo);var Ot=l.forwardRef(function(e,t){return l.createElement(fe,O({},e,{ref:t,sideCar:er}))});Ot.classNames=fe.classNames;var tr=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Y=new WeakMap,ae=new WeakMap,ie={},be=0,jt=function(e){return e&&(e.host||jt(e.parentNode))},nr=function(e,t){return t.map(function(n){if(e.contains(n))return n;var o=jt(n);return o&&e.contains(o)?o:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},or=function(e,t,n,o){var r=nr(t,Array.isArray(e)?e:[e]);ie[n]||(ie[n]=new WeakMap);var s=ie[n],i=[],a=new Set,f=new Set(r),m=function(g){!g||a.has(g)||(a.add(g),m(g.parentNode))};r.forEach(m);var h=function(g){!g||f.has(g)||Array.prototype.forEach.call(g.children,function(p){if(a.has(p))h(p);else try{var d=p.getAttribute(o),y=d!==null&&d!=="false",u=(Y.get(p)||0)+1,E=(s.get(p)||0)+1;Y.set(p,u),s.set(p,E),i.push(p),u===1&&y&&ae.set(p,!0),E===1&&p.setAttribute(n,"true"),y||p.setAttribute(o,"true")}catch(v){console.error("aria-hidden: cannot operate on ",p,v)}})};return h(t),a.clear(),be++,function(){i.forEach(function(g){var p=Y.get(g)-1,d=s.get(g)-1;Y.set(g,p),s.set(g,d),p||(ae.has(g)||g.removeAttribute(o),ae.delete(g)),d||g.removeAttribute(n)}),be--,be||(Y=new WeakMap,Y=new WeakMap,ae=new WeakMap,ie={})}},rr=function(e,t,n){n===void 0&&(n="data-aria-hidden");var o=Array.from(Array.isArray(e)?e:[e]),r=tr(e);return r?(o.push.apply(o,Array.from(r.querySelectorAll("[aria-live], script"))),or(o,r,n,"aria-hidden")):function(){return null}},he="Dialog",[Dt,Kr]=un(he),[sr,T]=Dt(he),kt=e=>{const{__scopeDialog:t,children:n,open:o,defaultOpen:r,onOpenChange:s,modal:i=!0}=e,a=l.useRef(null),f=l.useRef(null),[m,h]=on({prop:o,defaultProp:r??!1,onChange:s,caller:he});return c.jsx(sr,{scope:t,triggerRef:a,contentRef:f,contentId:me(),titleId:me(),descriptionId:me(),open:m,onOpenChange:h,onOpenToggle:l.useCallback(()=>h(g=>!g),[h]),modal:i,children:n})};kt.displayName=he;var Mt="DialogTrigger",ar=l.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,r=T(Mt,n),s=z(t,r.triggerRef);return c.jsx(D.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":_e(r.open),...o,ref:s,onClick:G(e.onClick,r.onOpenToggle)})});ar.displayName=Mt;var Ae="DialogPortal",[ir,Pt]=Dt(Ae,{forceMount:void 0}),Lt=e=>{const{__scopeDialog:t,forceMount:n,children:o,container:r}=e,s=T(Ae,t);return c.jsx(ir,{scope:t,forceMount:n,children:l.Children.map(o,i=>c.jsx(Ne,{present:n||s.open,children:c.jsx(wt,{asChild:!0,container:r,children:i})}))})};Lt.displayName=Ae;var de="DialogOverlay",Ft=l.forwardRef((e,t)=>{const n=Pt(de,e.__scopeDialog),{forceMount:o=n.forceMount,...r}=e,s=T(de,e.__scopeDialog);return s.modal?c.jsx(Ne,{present:o||s.open,children:c.jsx(lr,{...r,ref:t})}):null});Ft.displayName=de;var cr=Qt("DialogOverlay.RemoveScroll"),lr=l.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,r=T(de,n);return c.jsx(Ot,{as:cr,allowPinchZoom:!0,shards:[r.contentRef],children:c.jsx(D.div,{"data-state":_e(r.open),...o,ref:t,style:{pointerEvents:"auto",...o.style}})})}),K="DialogContent",Gt=l.forwardRef((e,t)=>{const n=Pt(K,e.__scopeDialog),{forceMount:o=n.forceMount,...r}=e,s=T(K,e.__scopeDialog);return c.jsx(Ne,{present:o||s.open,children:s.modal?c.jsx(ur,{...r,ref:t}):c.jsx(dr,{...r,ref:t})})});Gt.displayName=K;var ur=l.forwardRef((e,t)=>{const n=T(K,e.__scopeDialog),o=l.useRef(null),r=z(t,n.contentRef,o);return l.useEffect(()=>{const s=o.current;if(s)return rr(s)},[]),c.jsx(Ut,{...e,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:G(e.onCloseAutoFocus,s=>{var i;s.preventDefault(),(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:G(e.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:G(e.onFocusOutside,s=>s.preventDefault())})}),dr=l.forwardRef((e,t)=>{const n=T(K,e.__scopeDialog),o=l.useRef(!1),r=l.useRef(!1);return c.jsx(Ut,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=e.onCloseAutoFocus)==null||i.call(e,s),s.defaultPrevented||(o.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),o.current=!1,r.current=!1},onInteractOutside:s=>{var f,m;(f=e.onInteractOutside)==null||f.call(e,s),s.defaultPrevented||(o.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const i=s.target;((m=n.triggerRef.current)==null?void 0:m.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}})}),Ut=l.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:o,onOpenAutoFocus:r,onCloseAutoFocus:s,...i}=e,a=T(K,n),f=l.useRef(null),m=z(t,f);return yo(),c.jsxs(c.Fragment,{children:[c.jsx(Ct,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:r,onUnmountAutoFocus:s,children:c.jsx(Et,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":_e(a.open),...i,ref:m,onDismiss:()=>a.onOpenChange(!1)})}),c.jsxs(c.Fragment,{children:[c.jsx(fr,{titleId:a.titleId}),c.jsx(pr,{contentRef:f,descriptionId:a.descriptionId})]})]})}),Ie="DialogTitle",$t=l.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,r=T(Ie,n);return c.jsx(D.h2,{id:r.titleId,...o,ref:t})});$t.displayName=Ie;var Wt="DialogDescription",Kt=l.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,r=T(Wt,n);return c.jsx(D.p,{id:r.descriptionId,...o,ref:t})});Kt.displayName=Wt;var Bt="DialogClose",Ht=l.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,r=T(Bt,n);return c.jsx(D.button,{type:"button",...o,ref:t,onClick:G(e.onClick,()=>r.onOpenChange(!1))})});Ht.displayName=Bt;function _e(e){return e?"open":"closed"}var qt="DialogTitleWarning",[Br,Yt]=dn(qt,{contentName:K,titleName:Ie,docsSlug:"dialog"}),fr=({titleId:e})=>{const t=Yt(qt),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return l.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},hr="DialogDescriptionWarning",pr=({contentRef:e,descriptionId:t})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Yt(hr).contentName}}.`;return l.useEffect(()=>{var s;const r=(s=e.current)==null?void 0:s.getAttribute("aria-describedby");t&&r&&(document.getElementById(t)||console.warn(o))},[o,e,t]),null},mr=kt,gr=Lt,vr=Ft,yr=Gt,Er=$t,xr=Kt,Cr=Ht;function br({...e}){return c.jsx(mr,{"data-slot":"dialog",...e})}function wr({...e}){return c.jsx(gr,{"data-slot":"dialog-portal",...e})}function Sr({className:e,...t}){return c.jsx(vr,{"data-slot":"dialog-overlay",className:j("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t})}function Nr({className:e,children:t,showCloseButton:n=!0,...o}){return c.jsxs(wr,{"data-slot":"dialog-portal",children:[c.jsx(Sr,{}),c.jsxs(yr,{"data-slot":"dialog-content",className:j("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...o,children:[t,n&&c.jsxs(Cr,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[c.jsx(rn,{}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Rr({className:e,...t}){return c.jsx("div",{"data-slot":"dialog-header",className:j("flex flex-col gap-2 text-center sm:text-left",e),...t})}function Ar({className:e,...t}){return c.jsx("div",{"data-slot":"dialog-footer",className:j("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...t})}function Ir({className:e,...t}){return c.jsx(Er,{"data-slot":"dialog-title",className:j("text-lg leading-none font-semibold",e),...t})}function _r({className:e,...t}){return c.jsx(xr,{"data-slot":"dialog-description",className:j("text-muted-foreground text-sm",e),...t})}var Tr="Label",Vt=l.forwardRef((e,t)=>c.jsx(D.label,{...e,ref:t,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=e.onMouseDown)==null||r.call(e,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Vt.displayName=Tr;var Or=Vt;function jr({className:e,...t}){return c.jsx(Or,{"data-slot":"label",className:j("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}const Dr=({open:e,onOpenChange:t,apiKey:n,onApiKeySet:o})=>{const[r,s]=l.useState(n),[i,a]=l.useState(!1),[f,m]=l.useState(null),h=()=>{if(!r.trim()){m("API key is required");return}if(!r.startsWith("AIza")){m('Invalid API key format. Gemini API keys typically start with "AIza"');return}o(r),t(!1),m(null)},g=()=>{s(""),o(""),localStorage.removeItem("gemini-api-key"),m(null)};return c.jsx(br,{open:e,onOpenChange:t,children:c.jsxs(Nr,{className:"sm:max-w-[500px]",children:[c.jsxs(Rr,{children:[c.jsxs(Ir,{className:"flex items-center gap-2",children:[c.jsx(Zt,{className:"w-5 h-5"}),"Gemini API Key Configuration"]}),c.jsx(_r,{children:"Enter your Google Gemini API key to enable chat functionality. Your API key is stored locally in your browser and never sent to our servers."})]}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx(jr,{htmlFor:"api-key",children:"API Key"}),c.jsxs("div",{className:"relative",children:[c.jsx(ft,{id:"api-key",type:i?"text":"password",value:r,onChange:p=>{s(p.target.value),m(null)},placeholder:"AIza...",className:"pr-10"}),c.jsx(F,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>a(!i),children:i?c.jsx(en,{className:"h-4 w-4 text-muted-foreground"}):c.jsx(tn,{className:"h-4 w-4 text-muted-foreground"})})]}),f&&c.jsx("p",{className:"text-sm text-destructive",children:f})]}),c.jsxs("div",{className:"rounded-lg bg-muted p-3 space-y-2",children:[c.jsx("p",{className:"text-sm text-muted-foreground",children:c.jsx("strong",{children:"How to get an API key:"})}),c.jsxs("ol",{className:"text-sm text-muted-foreground space-y-1 list-decimal list-inside",children:[c.jsx("li",{children:"Go to Google AI Studio"}),c.jsx("li",{children:"Sign in with your Google account"}),c.jsx("li",{children:'Click on "Get API key" in the left sidebar'}),c.jsx("li",{children:"Create a new API key or use an existing one"}),c.jsx("li",{children:"Copy the key and paste it here"})]}),c.jsxs("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:["Get your API key",c.jsx(fn,{className:"w-3 h-3"})]})]}),c.jsx("div",{className:"rounded-lg bg-yellow-500/10 border border-yellow-500/20 p-3",children:c.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:[c.jsx("strong",{children:"Security Note:"})," Your API key is stored locally in your browser's storage and is never sent to our servers. Keep your API key private and do not share it with others."]})})]}),c.jsxs(Ar,{className:"flex items-center justify-between",children:[c.jsx(F,{type:"button",variant:"outline",onClick:g,disabled:!r,children:"Clear Key"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(F,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),c.jsx(F,{type:"button",onClick:h,children:"Save API Key"})]})]})]})})},kr=()=>{const[e,t]=l.useState([]),[n,o]=l.useState(""),[r,s]=l.useState(!1),[i,a]=l.useState(()=>localStorage.getItem("gemini-api-key")||""),[f,m]=l.useState(()=>localStorage.getItem("serp-api-key")||""),[h,g]=l.useState(!i),[p,d]=l.useState(null),[y,u]=l.useState(!0),[E,v]=l.useState({}),x=l.useRef(),b=l.useRef(null);l.useEffect(()=>{i&&(x.current=new eo(i,f),localStorage.setItem("gemini-api-key",i),f&&(localStorage.setItem("serp-api-key",f),x.current.setSerpApiKey(f)),x.current.setToolsEnabled(y),d(null))},[i,f,y]),l.useEffect(()=>{var C;(C=b.current)==null||C.scrollIntoView({behavior:"smooth"})},[e]);const S=async()=>{var k;if(!n.trim()||r)return;if(!((k=x.current)!=null&&k.isInitialized())){d("Please set your Gemini API key first"),g(!0);return}const C={id:`msg-${Date.now()}`,role:"user",content:n,timestamp:new Date};t(A=>[...A,C]),o(""),s(!0),d(null);try{const A=await x.current.sendMessage(n),J={id:`msg-${Date.now()}-assistant`,role:"assistant",content:A.text,timestamp:new Date,toolCalls:A.toolCalls,toolResults:A.toolResults};t(pe=>[...pe,J])}catch(A){console.error("Error sending message:",A),d("Failed to get response from Gemini. Please check your API key."),t(J=>J.filter(pe=>pe.id!==C.id))}finally{s(!1)}},N=C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),S())},I=()=>{var C;t([]),(C=x.current)==null||C.reset(),d(null)},w=C=>new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit"}).format(C),_=C=>{v(k=>({...k,[C]:!k[C]}))},$=C=>{if(!C.toolCalls||C.toolCalls.length===0)return null;const k=E[C.id];return c.jsxs("div",{className:"mt-2 p-2 bg-muted/50 rounded-md text-xs",children:[c.jsxs("button",{onClick:()=>_(C.id),className:"flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors",children:[c.jsx(De,{className:"w-3 h-3"}),c.jsxs("span",{children:["Used ",C.toolCalls.length," tool",C.toolCalls.length>1?"s":""]}),k?c.jsx(an,{className:"w-3 h-3"}):c.jsx(cn,{className:"w-3 h-3"})]}),k&&c.jsx("div",{className:"mt-2 space-y-2",children:C.toolCalls.map((A,J)=>c.jsxs("div",{className:"pl-4 border-l-2 border-muted-foreground/20",children:[c.jsxs("div",{className:"flex items-center gap-1 font-medium",children:[A.name==="web_search"&&c.jsx(mn,{className:"w-3 h-3"}),A.name==="web_crawl"&&c.jsx(hn,{className:"w-3 h-3"}),c.jsx("span",{children:A.name.replace("_"," ")})]}),c.jsxs("div",{className:"text-muted-foreground mt-1",children:[A.name==="web_search"&&`Searched: "${A.args.query}"`,A.name==="web_crawl"&&`Crawled: ${A.args.url}`]})]},J))})]})};return c.jsxs("div",{className:"flex flex-col h-screen bg-background",children:[c.jsx("div",{className:"border-b px-6 py-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(oe,{className:"w-6 h-6 text-primary"}),c.jsx("h1",{className:"text-xl font-semibold",children:"Gemini Chat"}),i&&c.jsxs(c.Fragment,{children:[c.jsx(Oe,{variant:"outline",className:"text-xs",children:"Connected"}),c.jsx(Oe,{variant:"secondary",className:"text-xs",children:"Gemini 2.0 Flash"})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs(F,{variant:y?"default":"outline",size:"sm",onClick:()=>{var C;u(!y),(C=x.current)==null||C.setToolsEnabled(!y)},title:y?"Tools enabled":"Tools disabled",children:[c.jsx(De,{className:"w-4 h-4 mr-2"}),"Tools ",y?"On":"Off"]}),c.jsxs(F,{variant:"outline",size:"sm",onClick:I,disabled:e.length===0,children:[c.jsx(sn,{className:"w-4 h-4 mr-2"}),"Clear"]}),c.jsxs(F,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[c.jsx(En,{className:"w-4 h-4 mr-2"}),"API Key"]})]})]})}),c.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[c.jsx(oe,{className:"w-12 h-12 mb-4"}),c.jsx("p",{className:"text-lg font-medium",children:"Start a conversation with Gemini"}),c.jsx("p",{className:"text-sm mt-2",children:"Type your message below to begin"})]}):c.jsxs("div",{className:"max-w-4xl mx-auto space-y-4",children:[e.map(C=>c.jsxs("div",{className:j("flex gap-3",C.role==="user"?"justify-end":"justify-start"),children:[C.role==="assistant"&&c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:c.jsx(oe,{className:"w-5 h-5 text-primary"})})}),c.jsxs("div",{className:j("max-w-[70%] space-y-1",C.role==="user"?"items-end":"items-start"),children:[c.jsxs(Te,{className:j("px-4 py-2",C.role==="user"?"bg-primary text-primary-foreground":"bg-muted"),children:[c.jsx("p",{className:"text-sm whitespace-pre-wrap",children:C.content}),$(C)]}),c.jsx("p",{className:"text-xs text-muted-foreground px-1",children:w(C.timestamp)})]}),C.role==="user"&&c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center",children:c.jsx(Cn,{className:"w-5 h-5 text-primary-foreground"})})})]},C.id)),r&&c.jsxs("div",{className:"flex gap-3 justify-start",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:c.jsx(oe,{className:"w-5 h-5 text-primary"})})}),c.jsx(Te,{className:"px-4 py-3 bg-muted",children:c.jsx(je,{className:"w-4 h-4 animate-spin"})})]}),c.jsx("div",{ref:b})]})}),p&&c.jsx("div",{className:"px-6 py-2",children:c.jsx("div",{className:"max-w-4xl mx-auto",children:c.jsx("div",{className:"bg-destructive/10 text-destructive px-4 py-2 rounded-md text-sm",children:p})})}),c.jsx("div",{className:"border-t px-6 py-4",children:c.jsx("div",{className:"max-w-4xl mx-auto",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx(ft,{value:n,onChange:C=>o(C.target.value),onKeyPress:N,placeholder:i?"Type your message...":"Set API key to start chatting...",disabled:!i||r,className:"flex-1"}),c.jsx(F,{onClick:S,disabled:!n.trim()||r||!i,children:r?c.jsx(je,{className:"w-4 h-4 animate-spin"}):c.jsx(vn,{className:"w-4 h-4"})})]})})}),c.jsx(Dr,{open:h,onOpenChange:g,apiKey:i,onApiKeySet:a})]})},Hr=function(){return c.jsx(kr,{})};export{Hr as component};
